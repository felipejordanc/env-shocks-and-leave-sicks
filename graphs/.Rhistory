date_labels = "%Y",                    # show only the year
minor_breaks = NULL                    # optional: no minor ticks
) +
labs(
title = paste("Data availability for", m),
x = "Estación",
y = "Fecha"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
print(p)  # show plot
# optionally save it:
ggsave(
filename = paste0(output_dir, "/availability_", m, ".png"),
plot = p,
width = 6,
height = 4
)
}
# --- Libraries ---
library(haven)
library(dplyr)
library(ggplot2)
output_dir <- "C:/Users/black/Documents/GitHub/env-shocks-and-leave-sicks/graphs"
df <- read_dta("C:/Users/black/Dropbox/Sick Leave, Heat, Pollution/data/B_intermediate/centers_nomiss.dta")
# Loop over all medida values
for (m in unique(df$medida)) {
df_sub <- df %>%
filter(medida == m & !is.na(suma))
p <- ggplot(df_sub, aes(x = Estacion, y = date)) +
geom_point(
color = viridis(1, option = "plasma", begin = 0.3, end = 0.4),  # soft green tone
alpha = 0.6,
size = 2
) +
scale_y_date(
date_breaks = "1 year",
date_labels = "%Y"
) +
labs(
title = paste("Data availability for", m),
x = "Estación",
y = "Fecha"
) +
theme_minimal(base_size = 12) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 8),  # smaller labels
plot.title = element_text(face = "bold", size = 14)
)
print(p)  # show plot
# optionally save it:
ggsave(
filename = paste0(output_dir, "/availability_", m, ".png"),
plot = p,
width = 6,
height = 4
)
}
# --- Libraries ---
library(haven)
library(dplyr)
library(ggplot2)
library(viridis)  # for nice perceptually uniform colors
output_dir <- "C:/Users/black/Documents/GitHub/env-shocks-and-leave-sicks/graphs"
df <- read_dta("C:/Users/black/Dropbox/Sick Leave, Heat, Pollution/data/B_intermediate/centers_nomiss.dta")
# Loop over all medida values
for (m in unique(df$medida)) {
df_sub <- df %>%
filter(medida == m & !is.na(suma))
p <- ggplot(df_sub, aes(x = Estacion, y = date)) +
geom_point(
color = viridis(1, option = "plasma", begin = 0.3, end = 0.4),  # soft green tone
alpha = 0.6,
size = 2
) +
scale_y_date(
date_breaks = "1 year",
date_labels = "%Y"
) +
labs(
title = paste("Data availability for", m),
x = "Estación",
y = "Fecha"
) +
theme_minimal(base_size = 12) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 8),  # smaller labels
plot.title = element_text(face = "bold", size = 14)
)
print(p)  # show plot
# optionally save it:
ggsave(
filename = paste0(output_dir, "/availability_", m, ".png"),
plot = p,
width = 6,
height = 4
)
}
# --- Libraries ---
library(haven)
library(dplyr)
library(ggplot2)
library(viridis)  # for nice perceptually uniform colors
output_dir <- "C:/Users/black/Documents/GitHub/env-shocks-and-leave-sicks/graphs"
df <- read_dta("C:/Users/black/Dropbox/Sick Leave, Heat, Pollution/data/B_intermediate/centers_nomiss.dta")
# Loop over all medida values
for (m in unique(df$medida)) {
df_sub <- df %>%
filter(medida == m & !is.na(suma))
p <- ggplot(df_sub, aes(x = Estacion, y = date)) +
geom_point(
color = viridis(1, option = "plasma", begin = 0.3, end = 0.4),  # soft green tone
alpha = 0.6,
size = 2
) +
scale_y_date(
date_breaks = "1 year",
date_labels = "%Y"
) +
labs(
title = paste("Data availability for", m),
x = "Estación",
y = "Fecha"
) +
theme_minimal(base_size = 12) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 6),  # smaller labels
plot.title = element_text(face = "bold", size = 14)
)
print(p)  # show plot
# optionally save it:
ggsave(
filename = paste0(output_dir, "/availability_", m, ".png"),
plot = p,
width = 6,
height = 4
)
}
# --- Libraries ---
library(haven)
library(dplyr)
library(ggplot2)
library(viridis)  # for nice perceptually uniform colors
output_dir <- "C:/Users/black/Documents/GitHub/env-shocks-and-leave-sicks/graphs"
df <- read_dta("C:/Users/black/Dropbox/Sick Leave, Heat, Pollution/data/B_intermediate/centers_nomiss.dta")
# Loop over all medida values
for (m in unique(df$medida)) {
df_sub <- df %>%
filter(medida == m & !is.na(suma))
# Sum of value for each estacion
df_sum <- df_sub %>%
group_by(estacion) %>%
summarise(total_value = sum(suma, na.rm = TRUE),
max_date = max(date))   # used to position the text label
p <- ggplot(df_sub, aes(x = Estacion, y = date)) +
geom_point(
color = viridis(1, option = "plasma", begin = 0.3, end = 0.4), # soft green dot
alpha = 0.6,
size = 2
) +
# Add sum label above dots
geom_text(
data = df_sum,
aes(x = estacion, y = max_date, label = round(total_value, 1)),
vjust = -0.8,            # move label above dots
size = 3,
fontface = "bold"
) +
scale_y_date(
date_breaks = "1 year",
date_labels = "%Y"
) +
labs(
title = paste("Data availability for", m),
x = "Estación",
y = "Fecha"
) +
theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 6)
)
print(p)  # show plot
# optionally save it:
ggsave(
filename = paste0(output_dir, "/availability_", m, ".png"),
plot = p,
width = 6,
height = 4
)
}
# --- Libraries ---
library(haven)
library(dplyr)
library(ggplot2)
library(viridis)  # for nice perceptually uniform colors
output_dir <- "C:/Users/black/Documents/GitHub/env-shocks-and-leave-sicks/graphs"
df <- read_dta("C:/Users/black/Dropbox/Sick Leave, Heat, Pollution/data/B_intermediate/centers_nomiss.dta")
# Loop over all medida values
for (m in unique(df$medida)) {
df_sub <- df %>%
filter(medida == m & !is.na(suma))
# Sum of value for each estacion
df_sum <- df_sub %>%
group_by(Estacion) %>%
summarise(total_value = sum(suma, na.rm = TRUE),
max_date = max(date))   # used to position the text label
p <- ggplot(df_sub, aes(x = Estacion, y = date)) +
geom_point(
color = viridis(1, option = "plasma", begin = 0.3, end = 0.4), # soft green dot
alpha = 0.6,
size = 2
) +
# Add sum label above dots
geom_text(
data = df_sum,
aes(x = estacion, y = max_date, label = round(total_value, 1)),
vjust = -0.8,            # move label above dots
size = 3,
fontface = "bold"
) +
scale_y_date(
date_breaks = "1 year",
date_labels = "%Y"
) +
labs(
title = paste("Data availability for", m),
x = "Estación",
y = "Fecha"
) +
theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 6)
)
print(p)  # show plot
# optionally save it:
ggsave(
filename = paste0(output_dir, "/availability_", m, ".png"),
plot = p,
width = 6,
height = 4
)
}
# --- Libraries ---
library(haven)
library(dplyr)
library(ggplot2)
library(viridis)  # for nice perceptually uniform colors
output_dir <- "C:/Users/black/Documents/GitHub/env-shocks-and-leave-sicks/graphs"
df <- read_dta("C:/Users/black/Dropbox/Sick Leave, Heat, Pollution/data/B_intermediate/centers_nomiss.dta")
# Loop over all medida values
for (m in unique(df$medida)) {
df_sub <- df %>%
filter(medida == m & !is.na(suma))
# Sum of value for each estacion
df_sum <- df_sub %>%
group_by(Estacion) %>%
summarise(total_value = sum(suma, na.rm = TRUE),
max_date = max(date))   # used to position the text label
p <- ggplot(df_sub, aes(x = Estacion, y = date)) +
geom_point(
color = viridis(1, option = "plasma", begin = 0.3, end = 0.4), # soft green dot
alpha = 0.6,
size = 2
) +
# Add sum label above dots
geom_text(
data = df_sum,
aes(x = Estacion, y = max_date, label = round(total_value, 1)),
vjust = -0.8,            # move label above dots
size = 3,
fontface = "bold"
) +
scale_y_date(
date_breaks = "1 year",
date_labels = "%Y"
) +
labs(
title = paste("Data availability for", m),
x = "Estación",
y = "Fecha"
) +
theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 6)
)
print(p)  # show plot
# optionally save it:
ggsave(
filename = paste0(output_dir, "/availability_", m, ".png"),
plot = p,
width = 6,
height = 4
)
}
# --- Libraries ---
library(haven)
library(dplyr)
library(ggplot2)
library(viridis)  # for nice perceptually uniform colors
output_dir <- "C:/Users/black/Documents/GitHub/env-shocks-and-leave-sicks/graphs"
df <- read_dta("C:/Users/black/Dropbox/Sick Leave, Heat, Pollution/data/B_intermediate/centers_nomiss.dta")
# Loop over all medida values
for (m in unique(df$medida)) {
df_sub <- df %>%
filter(medida == m & !is.na(suma))
# Sum of value for each estacion
df_sum <- df_sub %>%
group_by(Estacion) %>%
summarise(total_value = sum(suma, na.rm = TRUE),
max_date = max(date))   # used to position the text label
p <- ggplot(df_sub, aes(x = Estacion, y = date)) +
geom_point(
color = viridis(1, option = "plasma", begin = 0.3, end = 0.4), # soft green dot
alpha = 0.6,
size = 2
) +
# Add sum label above dots
geom_text(
data = df_sum,
aes(x = Estacion, y = max_date, label = round(total_value, 1)),
vjust = -0.8,            # move label above dots
size = 3,
angle = 45,
fontface = "bold"
) +
scale_y_date(
date_breaks = "1 year",
date_labels = "%Y"
) +
labs(
title = paste("Data availability for", m),
x = "Estación",
y = "Fecha"
) +
theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 6)
)
print(p)  # show plot
# optionally save it:
ggsave(
filename = paste0(output_dir, "/availability_", m, ".png"),
plot = p,
width = 6,
height = 4
)
}
# --- Libraries ---
library(haven)
library(dplyr)
library(ggplot2)
library(viridis)  # for nice perceptually uniform colors
output_dir <- "C:/Users/black/Documents/GitHub/env-shocks-and-leave-sicks/graphs"
df <- read_dta("C:/Users/black/Dropbox/Sick Leave, Heat, Pollution/data/B_intermediate/centers_nomiss.dta")
# Loop over all medida values
for (m in unique(df$medida)) {
df_sub <- df %>%
filter(medida == m & !is.na(suma))
# Sum of value for each estacion
df_sum <- df_sub %>%
group_by(Estacion) %>%
summarise(total_value = sum(suma, na.rm = TRUE),
max_date = max(date))   # used to position the text label
p <- ggplot(df_sub, aes(x = Estacion, y = date)) +
geom_point(
color = viridis(1, option = "plasma", begin = 0.3, end = 0.4),
alpha = 0.6,
size = 2
) +
geom_text(
data = df_sum,
aes(x = Estacion, y = max_date, label = round(total_value, 1)),
vjust = -0.8,
angle = 45,
size = 2,
fontface = "bold"
) +
scale_y_date(
date_breaks = "1 year",
date_labels = "%Y",
expand = expansion(mult = c(0.02, 0.12))   # << adds space above
) +
labs(
title = paste("Data availability for", m),
x = "Estación",
y = "Fecha"
) +
theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 6),
plot.title = element_text(margin = margin(b = 10), size = 14, face = "bold"),
plot.margin = margin(t = 20, r = 10, b = 20, l = 10)  # extra margins
)
print(p)  # show plot
# optionally save it:
ggsave(
filename = paste0(output_dir, "/availability_", m, ".png"),
plot = p,
width = 6,
height = 4
)
}
# --- Libraries ---
library(haven)
library(dplyr)
library(ggplot2)
library(viridis)  # for nice perceptually uniform colors
output_dir <- "C:/Users/black/Documents/GitHub/env-shocks-and-leave-sicks/graphs"
df <- read_dta("C:/Users/black/Dropbox/Sick Leave, Heat, Pollution/data/B_intermediate/centers_nomiss.dta")
# Loop over all medida values
for (m in unique(df$medida)) {
df_sub <- df %>%
filter(medida == m & !is.na(suma))
# Sum of value for each estacion
df_sum <- df_sub %>%
group_by(Estacion) %>%
summarise(total_value = sum(suma, na.rm = TRUE),
max_date = max(date))   # used to position the text label
p <- ggplot(df_sub, aes(x = Estacion, y = date)) +
geom_point(
color = viridis(1, option = "plasma", begin = 0.3, end = 0.4),
alpha = 0.6,
size = 1
) +
geom_text(
data = df_sum,
aes(x = Estacion, y = max_date, label = round(total_value, 1)),
vjust = -0.8,
angle = 45,
size = 2,
fontface = "bold"
) +
scale_y_date(
date_breaks = "1 year",
date_labels = "%Y",
expand = expansion(mult = c(0.02, 0.12))   # << adds space above
) +
labs(
title = paste("Data availability for", m),
x = "Estación",
y = "Fecha"
) +
theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 6),
plot.title = element_text(margin = margin(b = 10), size = 14, face = "bold"),
plot.margin = margin(t = 20, r = 10, b = 20, l = 10)  # extra margins
)
print(p)  # show plot
# optionally save it:
ggsave(
filename = paste0(output_dir, "/availability_", m, ".png"),
plot = p,
width = 6,
height = 4
)
}
# --- Libraries ---
library(haven)
library(dplyr)
library(ggplot2)
library(viridis)  # for nice perceptually uniform colors
output_dir <- "C:/Users/black/Documents/GitHub/env-shocks-and-leave-sicks/graphs"
df <- read_dta("C:/Users/black/Dropbox/Sick Leave, Heat, Pollution/data/B_intermediate/centers_nomiss.dta")
# Loop over all medida values
for (m in unique(df$medida)) {
df_sub <- df %>%
filter(medida == m & !is.na(suma))
# Sum of value for each estacion
df_sum <- df_sub %>%
group_by(Estacion) %>%
summarise(total_value = sum(suma, na.rm = TRUE),
max_date = max(date))   # used to position the text label
p <- ggplot(df_sub, aes(x = Estacion, y = date)) +
geom_point(
color = viridis(1, option = "plasma", begin = 0.3, end = 0.4),
alpha = 0.6,
size = 0.5
) +
geom_text(
data = df_sum,
aes(x = Estacion, y = max_date, label = round(total_value, 1)),
vjust = -0.8,
angle = 45,
size = 2,
fontface = "bold"
) +
scale_y_date(
date_breaks = "1 year",
date_labels = "%Y",
expand = expansion(mult = c(0.02, 0.12))   # << adds space above
) +
labs(
title = paste("Data availability for", m),
x = "Estación",
y = "Fecha"
) +
theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 6),
plot.title = element_text(margin = margin(b = 10), size = 14, face = "bold"),
plot.margin = margin(t = 20, r = 10, b = 20, l = 10)  # extra margins
)
print(p)  # show plot
# optionally save it:
ggsave(
filename = paste0(output_dir, "/availability_", m, ".png"),
plot = p,
width = 6,
height = 4
)
}
