) +
scale_fill_gradientn(
colors = my_cols(seq(0, 1, length.out = nrow(df))),
guide = "none"
) +
geom_hline(yintercept = 0, linetype = "dashed") +
coord_cartesian(ylim = c(-0.1, 0.5)) +
labs(
x = "Bin",
y = "Estimate",
title = "Regression Coefficients ",
subtitle = subtitle_text
) +
theme_minimal(base_size = 14) +
theme(
axis.text.x = element_text(angle = 60, hjust = 1),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank()
)
}
########################################################
# 9. GENERATE & SAVE PLOTS
########################################################
# Gradient palette (same behavior as before)
my_cols <- function(x) {
grDevices::colorRampPalette(c("#4575b4", "#ffffbf", "#d73027"))(length(x))
}
plots <- split(reg_long, reg_long$model) |>
map(~ plot_model(.x, unique(.x$model)))
ggsave("dummy_m.png",       plots$Dummy,       width = 12, height = 8, dpi = 300)
ggsave("spain_m.png",       plots$Spain,       width = 12, height = 8, dpi = 300)
ggsave("reactive_m.png",    plots$Reactive,    width = 12, height = 8, dpi = 300)
ggsave("anticipated_m.png", plots$Anticipated, width = 12, height = 8, dpi = 300)
########################################################
########################################################
# Load required packages
########################################################
library(tidyverse)
########################################################
# 1. READ .TEX FILE
########################################################
tex_file <- "C:/Users/black/Documents/GitHub/env-shocks-and-leave-sicks/tables/y_sick_w.tex"
raw <- readLines(tex_file)
########################################################
# 2. IDENTIFY COEFFICIENT AND SE ROWS
########################################################
coef_rows <- raw[str_detect(raw, "^tmax\\\\_dum")]
se_rows   <- raw[str_detect(raw, "^\\s*&\\s*\\(")]
########################################################
# 3. HELPERS
########################################################
# IMPORTANT: remove \sym{...} FIRST
clean_row <- function(x) {
x |>
str_replace_all("\\\\sym\\{\\*+\\}", "")
}
clean_num <- function(x) {
x |>
str_squish() |>
as.numeric()
}
extract_cells <- function(x) {
str_split(x, "&")[[1]][-1] |>
str_remove_all("\\\\") |>
str_trim()
}
########################################################
# 4. PARSE COEFFICIENTS (ALL 4, FIXED)
########################################################
coef_df <- tibble(row = coef_rows) |>
mutate(
row = clean_row(row),   # <-- FIX HERE
bin = str_extract(row, "dum\\\\_[0-9_]+") |>
str_replace_all("\\\\_", "_"),
vals = map(row, extract_cells)
) |>
unnest_wider(vals, names_sep = "_") |>
mutate(across(starts_with("vals"), clean_num))
########################################################
# 5. PARSE STANDARD ERRORS (ALL 4)
########################################################
se_df <- tibble(row = se_rows) |>
mutate(
vals = map(
row,
~ str_extract_all(.x, "\\(([0-9\\.]+)\\)")[[1]] |>
str_remove_all("[()]") |>
as.numeric()
)
) |>
unnest_wider(vals, names_sep = "_")
########################################################
# 6. COMBINE + LONG FORMAT
########################################################
models <- c("Dummy", "Spain", "Reactive", "Anticipated")
# ---- coefficients to long ----
coef_long <- coef_df |>
pivot_longer(
cols = starts_with("vals"),
names_to = "model_id",
values_to = "estimate"
) |>
mutate(
model = models[as.integer(str_remove(model_id, "vals_"))]
) |>
select(bin, model, estimate)
# ---- SEs to long ----
se_long <- coef_df |>
select(bin) |>
bind_cols(se_df) |>
pivot_longer(
cols = starts_with("vals"),
names_to = "model_id",
values_to = "se"
) |>
mutate(
model = models[as.integer(str_remove(model_id, "vals_"))]
) |>
select(bin, model, se)
# ---- combine correctly (JOIN, not bind_cols) ----
reg_long <- coef_long |>
left_join(se_long, by = c("bin", "model")) |>
group_by(model) |>
mutate(
lower = estimate - 1.96 * se,
upper = estimate + 1.96 * se,
bin_index = row_number()
) |>
ungroup()
########################################################
# 7. BIN LABELS (UNCHANGED)
########################################################
NEW_LABELS <- c(
dum_9 = "< 9",
dum_10 = "10–11",
dum_12 = "12–13",
dum_14 = "14–15",
dum_16 = "16–17",
dum_18 = "18–19",
dum_22 = "22–23",
dum_24 = "24–25",
dum_26 = "26–27",
dum_28 = "28–29",
dum_30 = "30–31",
dum_32 = "32–33",
dum_34 = "34–35",
dum_36 = "36–37",
dum_38 = "> 38"
)
reg_long <- reg_long |>
mutate(bin_label = recode(bin, !!!NEW_LABELS))
########################################################
# 8. PLOTTING FUNCTION
########################################################
plot_model <- function(df, subtitle_text) {
ggplot(df, aes(
x = fct_inorder(bin_label),
y = estimate,
fill = bin_index
)) +
geom_col(width = 0.8) +
geom_errorbar(
aes(ymin = lower, ymax = upper),
width = 0.15,
color = "black"
) +
scale_fill_gradientn(
colors = my_cols(seq(0, 1, length.out = nrow(df))),
guide = "none"
) +
geom_hline(yintercept = 0, linetype = "dashed") +
coord_cartesian(ylim = c(-0.1, 0.5)) +
labs(
x = "Bin",
y = "Estimate",
title = "Regression Coefficients ",
subtitle = subtitle_text
) +
theme_minimal(base_size = 14) +
theme(
axis.text.x = element_text(angle = 60, hjust = 1),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank()
)
}
########################################################
# 9. GENERATE & SAVE PLOTS
########################################################
# Gradient palette (same behavior as before)
my_cols <- function(x) {
grDevices::colorRampPalette(c("#4575b4", "#ffffbf", "#d73027"))(length(x))
}
plots <- split(reg_long, reg_long$model) |>
map(~ plot_model(.x, unique(.x$model)))
ggsave("dummy.png",       plots$Dummy,       width = 12, height = 8, dpi = 300)
ggsave("spain.png",       plots$Spain,       width = 12, height = 8, dpi = 300)
ggsave("reactive.png",    plots$Reactive,    width = 12, height = 8, dpi = 300)
ggsave("anticipated.png", plots$Anticipated, width = 12, height = 8, dpi = 300)
########################################################
# 1. READ .TEX FILE
########################################################
tex_file <- "C:/Users/black/Documents/GitHub/env-shocks-and-leave-sicks/tables/y_sick_w_min.tex"
raw <- readLines(tex_file)
########################################################
# 2. IDENTIFY COEFFICIENT AND SE ROWS
########################################################
coef_rows <- raw[str_detect(raw, "^tmin\\\\_dum")]
se_rows   <- raw[str_detect(raw, "^\\s*&\\s*\\(")]
########################################################
# 3. HELPERS
########################################################
# IMPORTANT: remove \sym{...} FIRST
clean_row <- function(x) {
x |>
str_replace_all("\\\\sym\\{\\*+\\}", "")
}
clean_num <- function(x) {
x |>
str_squish() |>
as.numeric()
}
extract_cells <- function(x) {
str_split(x, "&")[[1]][-1] |>
str_remove_all("\\\\") |>
str_trim()
}
########################################################
# 4. PARSE COEFFICIENTS (ALL 4, FIXED)
########################################################
coef_df <- tibble(row = coef_rows) |>
mutate(
row = clean_row(row),   # <-- FIX HERE
bin = str_extract(row, "dum\\\\_[0-9_]+") |>
str_replace_all("\\\\_", "_"),
vals = map(row, extract_cells)
) |>
unnest_wider(vals, names_sep = "_") |>
mutate(across(starts_with("vals"), clean_num))
########################################################
# 5. PARSE STANDARD ERRORS (ALL 4)
########################################################
se_df <- tibble(row = se_rows) |>
mutate(
vals = map(
row,
~ str_extract_all(.x, "\\(([0-9\\.]+)\\)")[[1]] |>
str_remove_all("[()]") |>
as.numeric()
)
) |>
unnest_wider(vals, names_sep = "_")
########################################################
# 6. COMBINE + LONG FORMAT
########################################################
models <- c("Dummy", "Spain", "Reactive", "Anticipated")
# ---- coefficients to long ----
coef_long <- coef_df |>
pivot_longer(
cols = starts_with("vals"),
names_to = "model_id",
values_to = "estimate"
) |>
mutate(
model = models[as.integer(str_remove(model_id, "vals_"))]
) |>
select(bin, model, estimate)
# ---- SEs to long ----
se_long <- coef_df |>
select(bin) |>
bind_cols(se_df) |>
pivot_longer(
cols = starts_with("vals"),
names_to = "model_id",
values_to = "se"
) |>
mutate(
model = models[as.integer(str_remove(model_id, "vals_"))]
) |>
select(bin, model, se)
# ---- combine correctly (JOIN, not bind_cols) ----
reg_long <- coef_long |>
left_join(se_long, by = c("bin", "model")) |>
group_by(model) |>
mutate(
lower = estimate - 1.96 * se,
upper = estimate + 1.96 * se,
bin_index = row_number()
) |>
ungroup()
########################################################
# 7. BIN LABELS (UNCHANGED)
########################################################
NEW_LABELS <- c(
dum_1 = "< 0",
dum_0 = "0–1",
dum_2 = "2–3",
dum_4 = "4–5",
dum_6 = "6–7",
dum_10 = "10–11",
dum_12 = "12–13",
dum_14 = "14–15",
dum_16 = "16–17",
dum_18 = "18–19",
dum_20 = ">20"
)
reg_long <- reg_long |>
mutate(bin_label = recode(bin, !!!NEW_LABELS))
########################################################
# 8. PLOTTING FUNCTION
########################################################
plot_model <- function(df, subtitle_text) {
ggplot(df, aes(
x = fct_inorder(bin_label),
y = estimate,
fill = bin_index
)) +
geom_col(width = 0.8) +
geom_errorbar(
aes(ymin = lower, ymax = upper),
width = 0.15,
color = "black"
) +
scale_fill_gradientn(
colors = my_cols(seq(0, 1, length.out = nrow(df))),
guide = "none"
) +
geom_hline(yintercept = 0, linetype = "dashed") +
coord_cartesian(ylim = c(-0.1, 0.5)) +
labs(
x = "Bin",
y = "Estimate",
title = "Regression Coefficients ",
subtitle = subtitle_text
) +
theme_minimal(base_size = 14) +
theme(
axis.text.x = element_text(angle = 60, hjust = 1),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank()
)
}
########################################################
# 9. GENERATE & SAVE PLOTS
########################################################
# Gradient palette (same behavior as before)
my_cols <- function(x) {
grDevices::colorRampPalette(c("#4575b4", "#ffffbf", "#d73027"))(length(x))
}
plots <- split(reg_long, reg_long$model) |>
map(~ plot_model(.x, unique(.x$model)))
ggsave("dummy_m.png",       plots$Dummy,       width = 12, height = 8, dpi = 300)
ggsave("spain_m.png",       plots$Spain,       width = 12, height = 8, dpi = 300)
ggsave("reactive_m.png",    plots$Reactive,    width = 12, height = 8, dpi = 300)
ggsave("anticipated_m.png", plots$Anticipated, width = 12, height = 8, dpi = 300)
########################################################
########################################################
# 1. READ .TEX FILE
########################################################
tex_file <- "C:/Users/black/Documents/GitHub/env-shocks-and-leave-sicks/tables/y_sick_w_min.tex"
raw <- readLines(tex_file)
########################################################
# 2. IDENTIFY COEFFICIENT AND SE ROWS
########################################################
coef_rows <- raw[str_detect(raw, "^tmin\\\\_dum")]
se_rows   <- raw[str_detect(raw, "^\\s*&\\s*\\(")]
########################################################
# 3. HELPERS
########################################################
# IMPORTANT: remove \sym{...} FIRST
clean_row <- function(x) {
x |>
str_replace_all("\\\\sym\\{\\*+\\}", "")
}
clean_num <- function(x) {
x |>
str_squish() |>
as.numeric()
}
extract_cells <- function(x) {
str_split(x, "&")[[1]][-1] |>
str_remove_all("\\\\") |>
str_trim()
}
########################################################
# 4. PARSE COEFFICIENTS (ALL 4, FIXED)
########################################################
coef_df <- tibble(row = coef_rows) |>
mutate(
row = clean_row(row),   # <-- FIX HERE
bin = str_extract(row, "dum\\\\_[0-9_]+") |>
str_replace_all("\\\\_", "_"),
vals = map(row, extract_cells)
) |>
unnest_wider(vals, names_sep = "_") |>
mutate(across(starts_with("vals"), clean_num))
########################################################
# 5. PARSE STANDARD ERRORS (ALL 4)
########################################################
se_df <- tibble(row = se_rows) |>
mutate(
vals = map(
row,
~ str_extract_all(.x, "\\(([0-9\\.]+)\\)")[[1]] |>
str_remove_all("[()]") |>
as.numeric()
)
) |>
unnest_wider(vals, names_sep = "_")
########################################################
# 6. COMBINE + LONG FORMAT
########################################################
models <- c("Dummy", "Spain", "Reactive", "Anticipated")
# ---- coefficients to long ----
coef_long <- coef_df |>
pivot_longer(
cols = starts_with("vals"),
names_to = "model_id",
values_to = "estimate"
) |>
mutate(
model = models[as.integer(str_remove(model_id, "vals_"))]
) |>
select(bin, model, estimate)
# ---- SEs to long ----
se_long <- coef_df |>
select(bin) |>
bind_cols(se_df) |>
pivot_longer(
cols = starts_with("vals"),
names_to = "model_id",
values_to = "se"
) |>
mutate(
model = models[as.integer(str_remove(model_id, "vals_"))]
) |>
select(bin, model, se)
# ---- combine correctly (JOIN, not bind_cols) ----
reg_long <- coef_long |>
left_join(se_long, by = c("bin", "model")) |>
group_by(model) |>
mutate(
lower = estimate - 1.96 * se,
upper = estimate + 1.96 * se,
bin_index = row_number()
) |>
ungroup()
########################################################
# 7. BIN LABELS (UNCHANGED)
########################################################
NEW_LABELS <- c(
dum_1 = "< 0",
dum_0 = "0–1",
dum_2 = "2–3",
dum_4 = "4–5",
dum_6 = "6–7",
dum_10 = "10–11",
dum_12 = "12–13",
dum_14 = "14–15",
dum_16 = "16–17",
dum_18 = "18–19",
dum_20 = ">20"
)
reg_long <- reg_long |>
mutate(bin_label = recode(bin, !!!NEW_LABELS))
########################################################
# 8. PLOTTING FUNCTION
########################################################
plot_model <- function(df, subtitle_text) {
ggplot(df, aes(
x = fct_inorder(bin_label),
y = estimate,
fill = bin_index
)) +
geom_col(width = 0.8) +
geom_errorbar(
aes(ymin = lower, ymax = upper),
width = 0.15,
color = "black"
) +
scale_fill_gradientn(
colors = my_cols(seq(0, 1, length.out = nrow(df))),
guide = "none"
) +
geom_hline(yintercept = 0, linetype = "dashed") +
coord_cartesian(ylim = c(-0.1, 0.5)) +
labs(
x = "Bin",
y = "Estimate",
title = "Regression Coefficients ",
subtitle = subtitle_text
) +
theme_minimal(base_size = 14) +
theme(
axis.text.x = element_text(angle = 60, hjust = 1),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank()
)
}
########################################################
# 9. GENERATE & SAVE PLOTS
########################################################
# Gradient palette (same behavior as before)
my_cols <- function(x) {
grDevices::colorRampPalette(c("#4575b4", "#ffffbf", "#d73027"))(length(x))
}
plots <- split(reg_long, reg_long$model) |>
map(~ plot_model(.x, unique(.x$model)))
ggsave("dummy_m.png",       plots$Dummy,       width = 12, height = 8, dpi = 300)
ggsave("spain_m.png",       plots$Spain,       width = 12, height = 8, dpi = 300)
ggsave("reactive_m.png",    plots$Reactive,    width = 12, height = 8, dpi = 300)
ggsave("anticipated_m.png", plots$Anticipated, width = 12, height = 8, dpi = 300)
########################################################
